import svg from"./svgIcons.js";class TreeselectInput{constructor({value:e,showTags:t,clearable:s,isAlwaysOpened:a,searchable:i,placeholder:r}){this.value=e,this.showTags=t??!0,this.searchable=i??!0,this.placeholder=r??"Search...",this.clearable=s??!0,this.isAlwaysOpened=a??!1,this.isOpened=!1,this.searchText="",this.srcElement=this.#createTreeselectInput(),this.#updateDOM()}focus(){const e=this.srcElement.querySelector(".treeselect-input__edit");e.focus()}blur(){this.isOpened&&this.#updateOpenClose()}updateValue(e){this.value=e,this.#updateTags(),this.#updateEditControl()}removeItem(t){this.value=this.value.filter(e=>e.id!==t),this.#emitInput(),this.#updateTags(),this.#updateEditControl()}clear(){this.value=[],this.searchText="",this.#emitSearch(""),this.#emitInput(),this.#updateTags(),this.#updateEditControl()}openClose(){this.#updateOpenClose()}#updateDOM(){this.#updateTags(),this.#updateEditControl(),this.#updateOperators()}#updateTags(){const e=this.srcElement.querySelector(".treeselect-input__tags");e.innerHTML="",this.showTags?e.append(...this.#createTags()):e.appendChild(this.#createCountElement())}#updateOperators(){const e=this.srcElement.querySelector(".treeselect-input__operators");e.innerHTML="",this.clearable&&e.appendChild(this.#createClearButton()),this.isAlwaysOpened||e.appendChild(this.#createInputArrow(this.isOpened))}#updateEditControl(){const e=this.srcElement.querySelector(".treeselect-input__edit");this.value?.length?e.removeAttribute("placeholder"):e.setAttribute("placeholder",this.placeholder),this.searchable?this.srcElement.classList.remove("treeselect-input--unsearchable"):this.srcElement.classList.add("treeselect-input--unsearchable"),e.value=this.searchText}#updateOpenClose(){this.isOpened?this.#emitClose():this.#emitOpen(),this.isOpened=!this.isOpened,this.#updateOperators()}#createTreeselectInput(){const e=document.createElement("div");e.classList.add("treeselect-input"),e.setAttribute("tabindex","-1");var t=this.#createTagsSection(),s=this.#createControl(),a=this.#createOperators();return e.addEventListener("click",()=>{this.focus(),this.#updateOpenClose()}),e.append(t,s,a),e}#createTagsSection(){const e=document.createElement("div");return e.classList.add("treeselect-input__tags"),e}#createTags(){return this.value.map(t=>{const e=document.createElement("div");e.classList.add("treeselect-input__tags-element"),e.setAttribute("tabindex","-1"),e.setAttribute("tag-id",t.id),e.setAttribute("title",t.name);var s=this.#createTagName(t.name),a=this.#createTagCross();return e.addEventListener("click",e=>{e.stopPropagation(),this.focus(),this.removeItem(t.id)}),e.append(s,a),e})}#createTagName(e){const t=document.createElement("span");return t.classList.add("treeselect-input__tags-name"),t.innerHTML=e,t}#createTagCross(){const e=document.createElement("span");return e.classList.add("treeselect-input__tags-cross"),e.innerHTML=svg.cross,e}#createCountElement(){const e=document.createElement("span");return e.classList.add("treeselect-input__tags-count"),this.value.length?e.innerHTML=1===this.value.length?this.value[0].name:this.value.length+" elements selected":e.innerHTML="",e}#createControl(){const t=document.createElement("input");return t.classList.add("treeselect-input__edit"),t.addEventListener("keydown",e=>{"Backspace"!==e.key||this.searchText.length||!this.value.length||this.showTags||this.clear(),"Backspace"===e.key&&!this.searchText.length&&this.value.length&&this.removeItem(this.value[this.value.length-1].id),"Space"!==e.code||this.searchText&&this.searchable||this.#updateOpenClose()}),t.addEventListener("input",e=>{e.stopPropagation(),this.searchable?this.#emitSearch(e.target.value):t.value="",this.searchText=t.value}),t}#createOperators(){const e=document.createElement("div");return e.classList.add("treeselect-input__operators"),e}#createClearButton(){const e=document.createElement("span");return e.classList.add("treeselect-input__clear"),e.setAttribute("tabindex","-1"),e.innerHTML=svg.clear,e.addEventListener("click",e=>{e.stopPropagation();const t=this.srcElement.querySelector(".treeselect-input__edit");t.focus(),this.clear()}),e}#createInputArrow(e){const t=document.createElement("span");return t.classList.add("treeselect-input__arrow"),t.innerHTML=e?svg.arrowUp:svg.arrowDown,t.addEventListener("click",e=>{e.stopPropagation(),this.focus(),this.#updateOpenClose()}),t}#emitInput(){this.srcElement.dispatchEvent(new CustomEvent("input",{detail:this.value}))}#emitSearch(e){this.srcElement.dispatchEvent(new CustomEvent("search",{detail:e}))}#emitOpen(){this.srcElement.dispatchEvent(new CustomEvent("open"))}#emitClose(){this.srcElement.dispatchEvent(new CustomEvent("close"))}}export default TreeselectInput;